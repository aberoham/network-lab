# -*- junos -*-
logical-systems {
    R0 {
        interfaces {
            lo0 unit 0 {
                family iso address 49.0001.000a.0a0a.0a00;
                family inet6 address 2001:db8:10:255::10/128;
            }
            ge-0/0/0 {
                description CE1;
                unit 0 {
                    family inet address 192.0.2.1/24;
                }
            }
            ge-0/0/2 {
                description R1;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:1::1/126;
                }
            }
            ge-0/0/4 {
                description R4;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:4::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a0::/64;
            router-id 192.168.255.0;
        }
        protocols {
            bgp {
                group to-R7 {
                    type internal;
                    export v4-CE1;
                    local-address 2001:db8:10:255::10;
                    neighbor 2001:db8:20:255::20 family inet unicast extended-nexthop;
                }
            }
            isis {
                interface ge-0/0/2.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a0::1a01 flavor psp;
                interface ge-0/0/4.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a0::1a04 flavor psp;
                interface lo0.0 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a0::d01 flavor usd;
            }
        }
        policy-options {
            policy-statement v4-CE1 {
                term 1 {
                    from {
                        protocol direct;
                        interface ge-0/0/0.0;
                    }
                    then {
                        next-hop 2001:db8:0:a0::d01;
                        accept;
                    }
                }
            }
        }
    }
    R1 {
        interfaces {
            lo0 unit 1 {
                family iso address 49.0001.0001.0101.0100;
                family inet6 address 2001:db8:1:255::1/128;
            }
            ge-0/0/3 {
                description R0;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:1::2/126;
                }
            }
            ge-0/0/6 {
                description R2;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:12:1/126;
                }
            }
            ge-0/0/8 {
                description R4;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:14::1/126;
                }
            }
            ge-0/0/10 {
                description R5;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:15::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a1::/64;
            router-id 192.168.255.1;
        }
        protocols {
            isis {
                interface ge-0/0/3.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a1::1a10 flavor psp;
                interface ge-0/0/6.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a1::1a12 flavor psp;
                interface ge-0/0/8.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a1::1a14 flavor psp;
                interface ge-0/0/10.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a1::1a15 flavor psp;
                interface lo0.1 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a1::d11 flavor usd;
            }
        }
    }
    R2 {
        interfaces {
            lo0 unit 2 {
                family iso address 49.0001.0002.0202.0200;
                family inet6 address 2001:db8:2:255::2/128;
            }
            ge-0/0/7 {
                description R1;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:12::2/126;
                }
            }
            ge-0/0/12 {
                description R3;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:23::1/126;
                }
            }
            ge-0/0/14 {
                description R4;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:24::1/126;
                }
            }
            ge-0/0/16 {
                description R5;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:25::1/126;
                }
            }
            ge-0/0/18 {
                description R6;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:26::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a2::/64;
            router-id 192.168.255.2;
        }
        protocols {
            isis {
                interface ge-0/0/7.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a2::1a21 flavor psp;
                interface ge-0/0/12.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a2::1a23 flavor psp;
                interface ge-0/0/14.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a2::1a24 flavor psp;
                interface ge-0/0/16.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a2::1a25 flavor psp;
                interface ge-0/0/18.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a2::1a26 flavor psp;
                interface lo0.2 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a2::d21 flavor usd;
            }
        }
    }
    R3 {
        interfaces {
            lo0 unit 3 {
                family iso address 49.0001.0003.0303.0300;
                family inet6 address 2001:db8:3:255::3/128;
            }
            ge-0/0/13 {
                description R2;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:23::2/126;
                }
            }
            ge-0/0/20 {
                description R5;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:35::1/126;
                }
            }
            ge-0/0/22 {
                description R6;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:36::1/126;
                }
            }
            ge-0/0/24 {
                description R7;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:37::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a3::/64;
            router-id 192.168.255.3;
        }
        protocols {
            isis {
                interface ge-0/0/13.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a3::1a32 flavor psp;
                interface ge-0/0/20.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a3::1a35 flavor psp;
                interface ge-0/0/22.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a3::1a36 flavor psp;
                interface ge-0/0/24.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a3::1a37 flavor psp;
                interface lo0.3 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a3::d31 flavor usd;
            }
        }
    }
    R4 {
        interfaces {
            lo0 unit 4 {
                family iso address 49.0001.0004.0404.0400;
                family inet6 address 2001:db8:4:255::4/128;
            }
            ge-0/0/5 {
                description R0;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:4::2/126;
                }
            }
            ge-0/0/9 {
                description R1;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:14::2/126;
                }
            }
            ge-0/0/15 {
                description R2;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:24::2/126;
                }
            }
            ge-0/0/26 {
                description R5;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:45::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a4::/64;
            router-id 192.168.255.4;
        }
        protocols {
            isis {
                interface ge-0/0/5.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a4::1a40 flavor psp;
                interface ge-0/0/9.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a4::1a41 flavor psp;
                interface ge-0/0/15.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a4::1a42 flavor psp;
                interface ge-0/0/26.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a4::1a45 flavor psp;
                interface lo0.4 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a4::d41 flavor usd;
            }
        }
    }
    R5 {
        interfaces {
            lo0 unit 5 {
                family iso address 49.0001.0005.0505.0500;
                family inet6 address 2001:db8:5:255::5/128;
            }
            ge-0/0/11 {
                description R1;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:15::2/126;
                }
            }
            ge-0/0/17 {
                description R2;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:25::2/126;
                }
            }
            ge-0/0/21 {
                description R3;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:35::2/126;
                }
            }
            ge-0/0/27 {
                description R4;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:45::2/126;
                }
            }
            ge-0/0/28 {
                description R6;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:56::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a5::/64;
            router-id 192.168.255.5;
        }
        protocols {
            isis {
                interface ge-0/0/11.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a5::1a51 flavor psp;
                interface ge-0/0/17.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a5::1a52 flavor psp;
                interface ge-0/0/21.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a5::1a53 flavor psp;
                interface ge-0/0/27.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a5::1a54 flavor psp;
                interface ge-0/0/28.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a5::1a56 flavor psp;
                interface lo0.5 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a5::d51 flavor usd;
            }
        }
    }
    R6 {
        interfaces {
            lo0 unit 6 {
                family iso address 49.0001.0006.0606.0600;
                family inet6 address 2001:db8:6:255::6/128;
            }
            ge-0/0/19 {
                description R2;
                unit 0 {
                    family iso;
                    family inet6 address 2011:db8:26::2/126;
                }
            }
            ge-0/0/23 {
                description R3;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:36::2/126;
                }
            }
            ge-0/0/29 {
                description R5;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:56::2/126;
                }
            }
            ge-0/0/30 {
                description R7;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:67::1/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a6::/64;
            router-id 192.168.255.6;
        }
        protocols {
            isis {
                interface ge-0/0/19.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a6::1a62 flavor psp;
                interface ge-0/0/23.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a6::1a63 flavor psp;
                interface ge-0/0/29.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a6::1a65 flavor psp;
                interface ge-0/0/30.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a6::1a67 flavor psp;
                interface lo0.6 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a6::d61 flavor usd;
            }
        }
    }
    R7 {
        interfaces {
            lo0 unit 7 {
                family iso address 49.0001.0007.0707.0700;
                family inet6 address 2001:db8:20:255::20/128;
            }
            ge-0/0/1 {
                description CE2;
                unit 0 {
                    family inet address 203.0.113.1/24;
                }
            }
            ge-0/0/25 {
                description R3;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:37::2/126;
                }
            }
            ge-0/0/31 {
                description R6;
                unit 0 {
                    family iso;
                    family inet6 address 2001:db8:67::2/126;
                }
            }
        }
        routing-options {
            source-packet-routing srv6 locator myloc 2001:db8:0:a7::/64;
            router-id 192.168.255.7;
        }
        policy-options {
            policy-statement v4-CE2 {
                term 1 {
                    from {
                        protocol direct;
                        interface ge-0/0/1.0;
                    }
                    then {
                        next-hop 2001:db8:0:a7::d71;
                        accept;
                    }
                }
            }
        }
        protocols {
            bgp {
                group to-R9 {
                    type internal;
                    export v4-CE2;
                    local-address 2001:db8:20:255::20;
                    neighbor 2001:db8:10:255::10 family inet unicast extended-nexthop;
                }
            }
            isis {
                interface ge-0/0/25.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a7::1a73 flavor psp;
                interface ge-0/0/31.0 level 2 srv6-adjacency-segment protected locator myloc end-x-sid 2001:db8:0:a7::1a76 flavor psp;
                interface lo0.7 passive;
                source-packet-routing srv6 locator myloc end-sid 2001:db8:0:a7::d71 flavor usd;
            }
        }
    }
}
groups {
    common {
        logical-systems <*> {
            policy-options policy-statement pplb then load-balance per-packet;
            routing-options {
                forwarding-table export pplb;
                autonomous-system 65550;
            }
            protocols isis {
                level 1 disable;
                interface <ge-*> {
                    node-link-protection;
                    point-to-point;
                }
            }
        }
    }
}
apply-groups common;
